---
title: 'Stat 272: FINAL PROJECT'
subtitle: 'Written by Emelyce & Inti & Nancy '
output:
  pdf_document:
    fig_height: 3
    fig_width: 4.5
  html_document: default
  word_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# STAGE II: EDA and Initial modelling.

## Introduction

## "Enhancing Precision in Breast Cancer Diagnosis through Image Analysis"

Advancements in image analysis software has enabled different feature data collection on cellular nucleic level such as nuclear size, shape, texture etc. High resolution images are taken of tissue samples and cell cultures and then analyzed with specialized softwares to extract features on each nucleus. This technological advancement opened new doors to exploration of tumor and cancer cells. The ability to collect these nuclear level features can help analyze and understand differences between normal and cancerous cells. It will be really interesting to find out if any of these features are different in cancerous cells as opposed to normal cells. The diagnosis of breast cancer traditionally has been invasive surgical procedures. But the ability to collect and examine cellular level data from a small amount of tissue of a tumor provides a more efficient and less invasive way to diagnose cancer.

In our project we aim to understand which of these collectable features through high resolution image processing can be used to separate benign cells from malignant cells for breast cancer. The findings can potentially help physicians diagnose cancer patients with higher precision and even enable early detection of cancer.

In our dataset, the observational (569 observations) units are individual tumor cells which are either benign or malignant. The 10 potential predictor variables we plan to explore to predict whether a cell is benign or malignant are: radius, perimeter, area, texture measured as SD of gray-scale values of the image of nucleus, compactness measured as perimeter^2 / area - 1.0, concavity measured as the severity of the concave portions of the contour, concave points measured as number of concave portions of the contour, smoothness measured as local variations in radius length, symmetry, and fractal dimension. The original dataset contained 3 measures of each of these variables. We are only going to use the first measurement of each of the variables and build a smaller dataset with just 12 variables made up of ID (unique identifier for each observation), Diagnosis (benign or malignant) as response variable and the 10 potential predictor variables. Although the multiple measurements of the variables could potentially help us build a more accurate model, our aim in this study is to find features that are helpful in diagnosing cancer cells as opposed to building an accurate model for cancer cell prediction.


## Exploratory Data Analysis.

```{r, echo=FALSE,results='hide', include=FALSE}
# Loading libraries
library(readr)
library(GGally)
library(ggplot2)
library(tidyverse)
library(tidyr)
library(mosaic)
```


```{r, results='hide', include=FALSE}
# Reading in the full dataset 
breast_cancer_data <- read_csv("~/Stats 272 S24/Project/Emelyce_Inti_Nancy /clean_breast_cancer_data.csv")

```

```{r, echo=FALSE, include=FALSE}
# Dropping unnecessary variables 
colnames(breast_cancer_data)

data_12_vars <- breast_cancer_data %>% 
  select(1:12) %>% 
  mutate(log_radius = log(radius1), log_concavity = log(concavity1)) %>% 
  mutate(Diagnosis = as.factor(Diagnosis))
```

# Correlations in Quantitative Predictor Variables: Insights from Matrix Scatter Plots"

Exploring the existing correlations between the quantitative predictor variables. The matrix scatter plots show that some of the variables are highly correlated radius-perimeter(0.998), radius-area(0.987), perimeter-area(0.987). For a relatively circular object such as cell nucleus these high correlation makes sense. Concavity-concave points(0.920), compactness-concave-points(0.829), compactness-concavity(0.882), area-concave points(824), perimeter-concave points(0.823), radius-concave points(0.823) also makes sense. The graphs are separated into two for better visibility. The full matrix plot is added in the appendix. While building our model we aim have to be careful and take measures to avoid multicollinearity.

```{r, echo=FALSE}
# Matrix scatter plot 
# radius, perimeter, area, compactness, concavity, concave points
data_12_vars %>% 
  ggpairs(columns = c(3, 5, 6, 8, 9, 10))
```

Among the rest of the predictor variables some are not that correlated but most of them have moderate to high correlation with at least one other predictor variables as can be seen in the full matrix plot in appendix.

```{r, echo=FALSE}
# texture, smoothness, symmetry, fractal dimension
data_12_vars %>% 
  ggpairs(columns = c(4, 7, 11, 12))+
  labs(title = "Matrix Scatterplot for Texture, Smoothness, Symmetry, Fractal dimension"
  )
```


Since radius, perimeter, and area are highly correlated we only look at the distribution of radius in benign and malignant cells. Both the mean (t-score -22.111) and median radius are significantly different between the two types of cells (Mean B:12.15 M: 17.46) (median B:12.2 M:17.3) (sd B:1.78 M:3.21). This shows that radius could be a potential predictor of tumor cell type. The relationship between Diagnosis and perimeter or area are explored in the appendix.

#BOX PLOTS

```{r, echo=FALSE}
# Boxplot by diagnosis types (Benign & Malignant)

#Radius vs Diagnosis boxplot
data_12_vars %>% 
  ggplot(aes(radius1, fill = Diagnosis))+
  geom_boxplot() +
  labs(title = "Radius vs Diagnosis boxplot",
    caption = "Boxplot by diagnosis types(Benign & Malignant)"
  )

# Radius vs Diagnosis favstats
favstats(radius1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant
t.test(radius1~Diagnosis, data = data_12_vars)
```


Since concavity, compactness, and concave points are highly correlated we only look at the distribution of concavity in benign and malignant cells. Both the mean (t-score -20.275) and median  are significantly different between the two types of cells (Mean B:0.046 M:0.160) (median B:0.037 M:0.150) (sd B:0.0434 M:0.745). This shows that concavity could be a potential predictor of tumor cell type. The relationship between Diagnosis and compactness or concave points are explored in the appendix.


```{r, echo=FALSE}
#Concavity vs Diagnosis
data_12_vars %>% 
  ggplot(aes(concavity1, fill = Diagnosis))+
  geom_boxplot()+
   labs(title = "Concavity vs Diagnosis boxplot"
  )

# Concavity vs Diagnosis favstats
favstats(concavity1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant 
t.test(concavity1~Diagnosis, data = data_12_vars)

```


Texture is one variable that didn't have any strong correlation with any other predictor variables. The mean (t-score -11.293) and median texture is significantly different in the between benign and malignant cells (Mean B:17.91 M:21.65), (Median B:17.39 M:21.46), (SD B:3.99 M:3.70). This shows that texture can be a useful predictor as well for the cell type.


```{r, echo=FALSE}
#Texture vs Diagnosis
data_12_vars %>% 
  ggplot(aes(texture1, fill = Diagnosis))+
  geom_boxplot()+
   labs(title = "Texture vs Diagnosis boxplot"
  )

# Texture vs Diagnosis favstats
favstats(texture1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant 
t.test(texture1~Diagnosis, data = data_12_vars)

```


The last group of predictor variables smoothness, symmetry, and fractal dimension have low to moderate correlation with one or more other predictor variables. The mean smoothness (t-score -9.22) and symmetry (t-score -8.02) are significantly different between benign and malignant cells. But the means of fractal dimension between benign and malignant cells are not significantly different with t-score of 0.42.


```{r, echo=FALSE}
#Smoothness vs Diagnosis
data_12_vars %>% 
  ggplot(aes(smoothness1, fill = Diagnosis))+
  geom_boxplot()+
   labs(title = "Smoothness vs Diagnosis boxplot"
  )
# Smoothness vs Diagnosis favstats
favstats(smoothness1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant 
t.test(smoothness1~Diagnosis, data = data_12_vars)
```


```{r, echo=FALSE}
#Symmetry vs Diagnosis
data_12_vars %>% 
  ggplot(aes(symmetry1, fill = Diagnosis))+
  geom_boxplot()+
   labs(title = "Symmetry vs Diagnosis boxplot"
  )
# Symmetry vs Diagnosis favstats
favstats(symmetry1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant 
t.test(symmetry1~Diagnosis, data = data_12_vars)
```


```{r, echo=FALSE}
#Fractal Dimension vs Diagnosis
data_12_vars %>% 
  ggplot(aes(fractal_dimension1, fill = Diagnosis))+
  geom_boxplot()+
   labs(title = "Fractal Dimension vs Diagnosis boxplot"
  )
# Fractal dimension vs Diagnosis favstats
favstats(fractal_dimension1~Diagnosis, data = data_12_vars)
# t-test for determining if the difference in mean is significant 
t.test(fractal_dimension1~Diagnosis, data = data_12_vars)
```

The distribution of concavity exhibited significant right skewness, which after logging the variable we obtained a more normalized distribution. Conversely, the distributions of radius, texture, smoothness, and symmetry are not that skewed and logging the variables does not change the distribution significantly.


```{r, echo=FALSE}
# Logged concavity
data_12_vars %>% 
  ggplot(aes(concavity1))+
  geom_histogram(color = "Black", fill = "Lightblue")+
   labs(title = "The Histogram of concavity")

data_12_vars %>% 
  ggplot(aes(log_concavity))+
  geom_histogram(color = "Black", fill = "Violet")+
   labs(title = "The Histogram of Logged concavity"
  )

```


## Initial Modelling:Exploring Single-Predictor Logistic Regression Models for Breast Cancer Diagnosis.

We have yet to explore the utilization of multiple predictors in logistic regression in our class. Therefore, our initial approach involves single-predictor logistic models focusing on radius, concavity, texture, smoothness, and symmetry, each revealing significant coefficients. The subsequent presentation of regression coefficients and confidence intervals showcases the distinctive characteristics of each model, followed by a detailed interpretation of the coefficients.

```{r, echo=FALSE}
# Possible models 

# Diagnosis~Radius
logistic_radius <- glm(as.factor(Diagnosis) ~ radius1, family = binomial(link = "logit"), data = data_12_vars)

summary(logistic_radius)

# Diagnosis~Concavity
logistic_concavity <- glm(as.factor(Diagnosis) ~ concavity1, family = binomial(link = "logit"), data = data_12_vars)

summary(logistic_concavity)


# Diagnosis~Texture
logistic_texture <- glm(as.factor(Diagnosis) ~ texture1, family = binomial(link = "logit"), data = data_12_vars)

summary(logistic_texture)

# Diagnosis~Smoothness
logistic_smoothness <- glm(as.factor(Diagnosis) ~ smoothness1, family = binomial(link = "logit"), data = data_12_vars)

summary(logistic_smoothness)


# Diagnosis~Symmetry
logistic_symmetry <- glm(as.factor(Diagnosis) ~ symmetry1, family = binomial(link = "logit"), data = data_12_vars)

summary(logistic_symmetry)
```


## Final Model Plan.

Our strategy for the final model entails to construct a multiple logistic regression model incorporating indicator variables and logged variables to predict the likelihood of a tumor cell being either benign or malignant.


## Appendix.

```{r, echo=FALSE, eval=FALSE}
#matrix scatter plot of all predictor variables
data_12_vars %>% 
  ggpairs(columns = 3:12)+
  labs(title = "The Matrix Scatter Plot of all Predictor Variables"
  )

#Perimeter vs Diagnosis
data_12_vars %>% 
  ggplot(aes(perimeter1, fill = Diagnosis))+
  geom_boxplot()+
  labs(title = "The Boxplot for Perimeter vs Diagnosis",
       caption = "B for benign and M for Malignant"
  )

#Area vs Diagnosis
data_12_vars %>% 
  ggplot(aes(area1, fill = Diagnosis))+
  geom_boxplot()+
  labs(title = "The Boxplot for Area vs Diagnosis",
       caption = "B for benign and M for Malignant"
  )


#Compactness vs Diagnosis
data_12_vars %>% 
  ggplot(aes(compactness1, fill = Diagnosis))+
  geom_boxplot()+
  labs(title = "The Boxplot for Compactness vs Diagnosis",
       caption = "B for benign and M for Malignant"
  )

#Concave points vs Diagnosis
data_12_vars %>% 
  ggplot(aes(concave_points1, fill = Diagnosis))+
  geom_boxplot()+
  labs(title = "The Boxplot for Concave points vs Diagnosis",
       caption = "B for benign and M for Malignant"
  )


#Fractal Dimension vs Diagnosis
data_12_vars %>% 
  ggplot(aes(fractal_dimension1, fill = Diagnosis))+
  geom_boxplot()+
  labs(title = "The Boxplot for Fractal Dimension vs Diagnosis",
       caption = "B for benign and M for Malignant"
  )

```


```{r}
# Proportions tables 
table(data_12_vars$Diagnosis) %>% 
  addmargins()

table(data_12_vars$Diagnosis) %>% 
  proportions()

# Histograms of quantitative variables 
data_12_vars %>% 
  ggplot(aes(radius1))+
  geom_histogram(color = "Black", fill = "Orange")+
   labs(title = "Histogram of quantitative variable: radius1")

data_12_vars %>% 
  ggplot(aes(perimeter1))+
  geom_histogram(color = "Black", fill = "Gold")+
   labs(title = "Histogram of quantitative variable: perimeter1")

data_12_vars %>% 
  ggplot(aes(area1))+
  geom_histogram(color = "Black", fill = "Brown")+
   labs(title = "Histogram of quantitative variable: area1")

data_12_vars %>% 
  ggplot(aes(texture1))+
  geom_histogram(color = "Black", fill = "darkolivegreen3")+
   labs(title = "Histogram of quantitative variable: texture1")

data_12_vars %>% 
  ggplot(aes(smoothness1))+
  geom_histogram(color = "Black", fill = "cornsilk")+
   labs(title = "Histogram of quantitative variable: smoothness1")

data_12_vars %>% 
  ggplot(aes(compactness1))+
  geom_histogram(color = "Black", fill = "coral2")+
   labs(title = "Histogram of quantitative variable: compactness1")


data_12_vars %>% 
  ggplot(aes(concavity1))+
  geom_histogram(color = "Black", fill = "darkturquoise")+
   labs(title = "Histogram of quantitative variable: concavity1")

data_12_vars %>% 
  ggplot(aes(concave_points1))+
  geom_histogram(color = "Black", fill = "darkslategray4")+
   labs(title = "Histogram of quantitative variable: concave_points1")

data_12_vars %>% 
  ggplot(aes(symmetry1))+
  geom_histogram(color = "Black", fill = "darkcyan")+
   labs(title = "Histogram of quantitative variable: symmetry1")

data_12_vars %>% 
  ggplot(aes(fractal_dimension1))+
  geom_histogram(color = "Black", fill = "deeppink3")+
   labs(title = "Histogram of quantitative variable: fractal_dimension1")
```



```{r, include=FALSE, eval=FALSE}
# Creating logged variables due to skewed distribution
data_12_vars %>% 
  ggplot(aes(radius1))+
  geom_histogram()

data_12_vars %>% 
  ggplot(aes(log_radius))+
  geom_histogram()

```



